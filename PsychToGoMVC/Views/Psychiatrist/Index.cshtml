@using PsychToGo.API.DTO;
@model IEnumerable<PsychiatristDTO>

@{
    ViewData["Title"] = "Psychiatrists";
    ViewBag.CurrentUrl = "~/Psychiatrist/Index";
}

<head>
    <link rel="stylesheet" href="~/PsychToGo.Client.styles.css" asp-append-version="true" />
</head>

<form method="get" asp-action="index">

    <h1 class="text-center">PSYCHIATRISTS</h1>
    <div class="search-box flex">
        <div class="flex-1">
            <select class="search-input" name="searchBy">
                @foreach (var fields in ViewBag.SearchFields)
                {
                    if (fields.Key == ViewBag.CurrentSearchBy)
                    {
                        <option value="@fields.Key" selected="selected">@fields.Value</option>
                    }
                    <option value="@fields.Key">@fields.Value</option>
                }
            </select>
            <input type="search" id="search" name="searchString" value="@ViewBag.CurrentSearchString" class="search-input" placeholder="Search.." />
            <button class="btn btn-dark">Search</button>
            <a class="btn btn-danger" asp-action="Index">Clear all</a>
            @if (User.IsInRole( "admin" ))
            {
                <a class="btn btn-primary" asp-action="CreatePsychiatristMVC">Create</a>
            }
        </div>



        <table class="table table-hover border shadow-lg">
            <thead>
                <tr>

                    <th>
                        @Html.DisplayNameFor(model => model.Name)
                    </th>
                    <th>
                        Last name
                    </th>

                    <th>
                        @Html.DisplayNameFor(model => model.Email)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Phone)
                    </th>
                    @if (User.IsInRole( "admin" ))
                    {
                        <th>
                            Date of Birth
                        </th>
                        <th>
                            Age
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Address)
                        </th>
                        <th>
                            Operations
                        </th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var psychiatrist in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => psychiatrist.Name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => psychiatrist.LastName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => psychiatrist.Email)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => psychiatrist.Phone)
                        </td>
                        @if (User.IsInRole( "admin" ))
                        {
                            <td>
                                @psychiatrist.DateOfBirth.ToString("yyyy-MM-dd")
                            </td>
                            <td>
                                @Math.Round((DateTime.Now - psychiatrist.DateOfBirth).TotalDays / 365.25)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => psychiatrist.Address)
                            </td>

                            <td class="operations-index">
                                <a class="btn btn-info " asp-action="PsychiatristDetails" asp-route-id="@psychiatrist.Id">Details</a>
                                <a class="btn btn-warning " asp-action="EditPsychiatrist" asp-route-id="@psychiatrist.Id">Edit</a>
                                <a class="btn btn-danger " asp-action="DeletePsychiatrist" asp-route-id="@psychiatrist.Id">Delete</a>

                            </td>
                        }

                    </tr>
                }
            </tbody>
        </table>

    </div>
</form>
